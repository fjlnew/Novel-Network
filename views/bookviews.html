<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="icon" href="../public/img/logo_head.png" type="image/x-icon" />
    <link rel="stylesheet" href="../public/css/bookviews.css">
    <link rel="stylesheet" href="../public/css/iconfont.css">
</head>

<body>
    <div class="wrap">
        <div class="pin-nav">
            <div class="box-center myselectbox cf">
                <div class="nav-list site-nav fl">
                    <ul>
                        <li class="site">
                            <a class="pin-logo" href="/">
                                <span class="sanjiaospan"></span>
                            </a>
                            <div class="dropdown">
                                <a href="#">起点女生网</a>
                                <a href="#">创世中文网</a>
                                <a href="#">云起书院</a>
                            </div>
                        </li>
                        <li><a href="#">玄幻</a></li>
                        <li><a href="#">都市</a></li>
                        <li><a href="#">仙侠</a></li>
                        <li><a href="#">科幻</a></li>
                        <li><a href="#">游戏</a></li>
                        <li><a href="#">历史</a></li>
                        <li><a href="#">排行</a></li>
                        <li class="getmorebook">
                            <a href="#">更多<span class="sanjiaospan ml10"></span></a>
                            <div class="dropdown">
                                <a href="#">全部小说</a>
                                <a href="#">轻小说</a>
                                <a href="#">奇幻</a>
                                <a href="#">武侠</a>
                                <a href="#">悬疑</a>
                                <a href="#">军事</a>
                                <a href="#">现实</a>
                                <a href="#">体育</a>
                                <a href="#">短篇</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="nav-list min-nav fr">
                    <ul class="cf">
                        <li class="min-search">
                            <div class="selectbot">
                                <span class="iconfont icon-fangdajing"></span>
                            </div>
                            <input type="text" placeholder="请输入书本名称">
                        </li>
                        <li class="line"></li>
                        <li class="sign-out">
                            <a href="/">登录</a>
                            <a href="/register">注册</a>
                        </li>
                        <li class="sign-in">
                            <a></a>
                            <em>|</em>
                            <a class="zhuce" href="/loginout">注销</a>
                        </li>
                        <li class="line"></li>
                        <li class="topbook-shelf">
                            <a href="#"><span class="iconfont icon-shujia"></span> 我的书架</a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="top-bg-box">
            <span class="back-to-left">
                <a href="#">首页</a>
                <em>></em>
                <a href="#">轻小说频道</a>
            </span>
            <span class="back-to-top">热门游戏</span>
        </div>
        <div class="border-shadow">
            <span></span>
            <span></span>
        </div>
        <div class="book-detail center990">
            <div class="book-information cf">
                <div class="book-img">
                    <a href="">
                        <img alt="">
                    </a>
                </div>
                <div class="book-info">
                    <h1>
                        <em></em>
                        <span>
                            <a href="#"></a>
                            著
                        </span>
                    </h1>
                    <p class="tag">
                        <span class="blue">连续</span>
                        <span class="blue">签约</span>
                        <span class="blue">免费</span>
                        <a class="red" href="#">仙侠</a>
                        <a class="red" href="#">修真</a>
                    </p>
                    <p class="intor"></p>
                    <p class="booksize">
                        <em></em><cite>万字</cite><i>|</i>
                        <em></em><cite>万总推荐</cite><i>|</i>
                        <em></em><cite>周推荐</cite>
                    </p>
                    <p class="book-btn">
                        <a class="red-btn" href="">免费试读</a>
                        <a class="blue-btn" href="">加入书架</a>
                        <a class="blue-btn" href="">投票互动</a>
                        <a class="red-btn" href="">手机app阅读</a>
                    </p>
                </div>
                <div class="comment-wrap">
                    <div class="commentwrap">
                        <div class="j_bookscore">
                            <span>
                                <cite class="score1">0</cite>
                                <em>.</em>
                            </span>
                            <i class="score2">0</i>
                        </div>
                        <div class="j_usercount">
                            人评价
                        </div>
                    </div>
                </div>
                <div class="take-wrap">
                    <a href="#">订阅</a>
                </div>

            </div>
            <div class="center-nav-wrap cf">
                <div class="nav-wrap fl">
                    <ul>
                        <li class="act"><a class="allcharpter" href="#">目录(章)</a></li>
                    </ul>
                </div>
            </div>
            <div class="catalog-content-wrap cf">
                <div class="wolume-wrap">
                </div>
            </div>
            <div class="book-content-wrap cf"></div>
        </div>

    </div>

    <div class="footer">
        <div class="box-center">
            <div class="footer-text">
                <p>上海网警提示：网络刷单是违法 切莫轻信有返利，网上交友套路多 卖惨要钱需当心，电子红包莫轻点 个人信息勿填写，仿冒客服来行骗 官方核实最重要，招工诈骗有套路 预交费用需谨慎，低价充值莫轻信
                    莫因游戏陷套路，连接WIFI要规范 确认安全再连接，抢购车票有章法 确认订单再付款，白条赊购慎使用 提升额度莫轻信，网购预付有风险 正规渠道很重要 如网民接到962110电话，请立即接听。
                </p>
            </div>
            <div class="friend-link">
                <em>
                    <a href="#">阅文集团</a><cite>旗下网站：</cite>
                </em>
                <a href="#">起点中文网</a>
                <a href="#">起点女生网</a>
                <a href="#">创世中文网</a>
                <a href="#">云起书院</a>
                <a href="#">红袖添香</a>
                <a href="#">小说阅读网</a>
                <a href="#">言情小说吧</a>
                <a href="#">潇湘书院</a>
                <a href="#">天方听书网</a>
                <a href="#">懒人听书</a>
                <a href="#">阅文悦读</a>
                <a href="#">QQ阅读</a>
                <a href="#">起点读书</a>
                <a href="#">作家助手</a>
                <a href="#">起点国际版</a>
            </div>
            <div class="link">
                <a href="#">关于我们</a>
                <a href="#">联系我们</a>
                <a href="#">加入我们</a>
                <a href="#">客服中心</a>
                <a href="#">提交建议</a>
                <a href="#">举报中心</a>
            </div>
            <p>Copyright (C) 2002-2019 www.qidian.com All Right Reserved版权所有 上海玄霆娱乐信息科技有限公司</p>
            <p>上海玄霆娱乐信息科技有限公司 增值电信业务经营许可证沪B2-20080046 沪网文[2012]0068-008 新出网证（沪）字010 沪ICP备08017520号-1</p>
            <p>请所有作者发布作品时务必遵守国家互联网信息管理办法规定，我们拒绝任何色情小说，一经发现，即作删除！客服电话：010-59357051</p>
            <p>本站所收录作品、社区话题、书库评论及本站所做之广告均属个人行为，与本站立场无关</p>
            <div class="safety-box">
                <div class="safety-img dib-wrap">
                    <a class="site1" href=""></a>
                    <a class="site2" href=""></a>
                    <a class="site3" href=""></a>
                    <a class="site4" href=""></a>
                    <a class="site5" href=""></a>
                    <a class="site6" href=""></a>
                    <a class="site7" href=""></a>
                </div>
            </div>
        </div>
    </div>

    <script>
        var sitenav = document.querySelectorAll('.site-nav ul li');
        sitenav.forEach(el => {
            el.onmouseover = function () {
                el.classList.add('act')
            }
            el.onmouseout = function () {
                el.classList.remove('act')
            }
        });

        var topselect = document.querySelector('.pin-nav');
        document.onscroll = function () {
            if (document.documentElement.scrollTop > 300) {
                topselect.classList.add('show')
            } else {
                topselect.classList.remove('show')
            }
        }


        var mynewbookviews = {}
        var bookviews = "<%= bookview.bookviews %>";

        var bookviews = bookviews.replace(/&#34;/g, '');
        var bookviews = bookviews.replace('[{', '');
        var bookviews = bookviews.replace('}]', '');
        var bookviews = bookviews.split(',')
        for (var i = 0; i < bookviews.length; i++) {
            var taps = bookviews[i].split(':');
            mynewbookviews[taps[0]] = taps[1];
        }

        usertap(mynewbookviews)

        function usertap(data) {
            var bookimg = document.querySelector('.book-img a img');
            var bookname = document.querySelector('.book-info h1 em');
            var bookauto = document.querySelector('.book-info h1 span a');
            var bookintroduce = document.querySelector('.book-info .intor');
            var bookreders = document.querySelectorAll('.book-info .booksize em');
            bookimg.src = `../public/img/allbooksimg/${data.bookname}.jpg`;
            bookname.innerHTML = `${data.bookname}`;
            bookauto.innerHTML = `${data.bookautor}`;
            bookintroduce.innerHTML = `${data.bookintroduce}`;
            var booksize = (data.booksize / 10000).toFixed(1);
            bookreders[0].innerHTML = `${booksize}`;
            var readersize = (data.bookReaders / 3000).toFixed(1);
            bookreders[1].innerHTML = `${readersize}`;
            var readertuijiansize = (data.bookReaders / 60).toFixed(0);
            bookreders[2].innerHTML = `${readertuijiansize}`;

        }

        var mynewbookcapterviews = [];
        var bookcapterviews = "<%= bookview.bookcapterviews %>";
        var bookcapterviews = bookcapterviews.replace(/&#34;/g, '');
        var bookcapterviews = bookcapterviews.split('{')
        for (var i = 1; i < bookcapterviews.length; i++) {
            mynewbookcapterviews[i - 1] = {};
            bookcapterviews[i] = bookcapterviews[i].replace('},', '');
            bookcapterviews[i] = bookcapterviews[i].split(',');
            for (var j = 0; j < bookcapterviews[i].length; j++) {
                var taps = bookcapterviews[i][j].split(':');
                mynewbookcapterviews[i - 1][taps[0]] = taps[1];
            }
        }

        var mynewcaptername = [];
        var captername = "<%= bookview.captername %>";
        var captername = captername.replace(/&#34;/g, '');
        var captername = captername.replace('}]', '');
        var captername = captername.split('{')
        for (var i = 1; i < captername.length; i++) {
            mynewcaptername[i - 1] = {};
            captername[i] = captername[i].replace('},', '');
            captername[i] = captername[i].split(',');
            for (var j = 0; j < captername[i].length; j++) {
                var taps = captername[i][j].split(':');
                mynewcaptername[i - 1][taps[0]] = taps[1];
            }
        }

        captertap(mynewcaptername, mynewbookcapterviews);

        function captertap(bigcapter, samllcapter) {
            var captersize = [bigcapter.length];
            var fontsize = [bigcapter.length];
            for (var p = 0; p < bigcapter.length; p++) {
                captersize[p] = 0;
                fontsize[p] = 0;
            }
            var allcharpter = document.querySelector('.allcharpter');
            allcharpter.innerHTML = `目录(${samllcapter.length}章)`;
            var wolumewrap = document.querySelector('.wolume-wrap');
            for (var i = 0; i < bigcapter.length; i++) {
                for (var j = 0; j < samllcapter.length; j++) {
                    if (bigcapter[i].capterid == samllcapter[j].chapterid) {
                        captersize[i] = captersize[i] + 1;
                        fontsize[i] = fontsize[i] + parseInt(samllcapter[j].chaptersize);
                    }
                }
                var volume = document.createElement('div');
                volume.className = 'volume';
                wolumewrap.appendChild(volume)
                var h3 = document.createElement('h3');
                var freefont = '免费';
                var freesize = 'free';
                if (bigcapter[i].capterid > 3) {
                    freefont = 'vip';
                    freesize = 'vip';
                }
                h3.innerHTML = ` <em class="btn">分卷阅读</em>
                            ${bigcapter[i].captername}<i>·</i>共${captersize[i]}章
                            <span class="${freesize}">${freefont}</span>
                            <em class="count">本卷共<cite>${fontsize[i]}</cite>字</em>`;
                volume.appendChild(h3);
                var capterul = document.createElement('ul');
                capterul.className = 'cf';
                volume.appendChild(capterul);

                for (var j = 0; j < samllcapter.length; j++) {
                    if (bigcapter[i].capterid == samllcapter[j].chapterid) {
                        var mycapterli = document.createElement('li');
                        mycapterli.innerHTML =
                            `<a href="${samllcapter[j].bookchapter}">第${samllcapter[j].bookchapter}章,${samllcapter[j].bookchaptername}</a>`;
                        capterul.appendChild(mycapterli);
                    }
                }
            }

        }


        var peopleviews = "<%= bookview.people %>";
        var peopleview = {};
        var peopleviews = peopleviews.replace(/&#34;/g, '');
        var peopleviews = peopleviews.replace('}]', '');
        var peopleviews = peopleviews.replace('[{', '');
        var peopleviews = peopleviews.split(',');
        for (var i = 0; i < peopleviews.length; i++) {
            peopleviews[i] = peopleviews[i].split(':');
            peopleview[peopleviews[i][0]] = peopleviews[i][1];
        }
        var signout = document.querySelector('.sign-out');
        var signin = document.querySelector('.sign-in');
        console.log(peopleviews)
        if (peopleviews[0] != '') {
            signout.classList.add('disnone');
            signin.classList.remove('disnone');
            var signinname = document.querySelector('.sign-in a');
            signinname.innerHTML = `你好${peopleview.username}`;
        } else {
            signout.classList.remove('disnone');
            signin.classList.add('disnone');
        }
    </script>
</body>

</html>